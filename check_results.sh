#!/bin/bash
#
#check results
#
#
ABSOLUTE_PATH="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
LOG_DIR=${ABSOLUTE_PATH}/log

menu () {
clear
while true ;do
    clear
    show_results 
    echo -e "\nScan Results Menu"
    echo -e "---------------------------"
     echo -e "\nPlease Choose an Option"
	CHOICES="display_malware display_benign display_unrecognized clear_logs quit"
	select choice in $CHOICES
	
	  do 
	    case $choice in
          display_malware)
		display_malware
		;;
	      display_benign)
	      display_benign 
		;;
	      display_unrecognized)
	      find_unrecognized
	      display_unrecognized
		;;
		clear_logs)
	      clear_logs
	      #return to main menu
	      $(dirname "${0}")/setup.sh
	    ;;
	      quit)
		$(dirname "${0}")/setup.sh
		;;	
	    esac
	    break;
          done	;
done;
	}


show_results () {
    echo -e "\n-------------------------------------------" 
    #use grep and word cound to find totals
    echo $(grep  -o "ID"  ${LOG_DIR}/found_malware.txt | wc -l) "Malware found"
    echo $(grep  "ID"  ${LOG_DIR}/benign.txt | wc -l) "Benign found"
    #call find_unrecognized function
    find_unrecognized
    #use word count to display unknown hahses (this way omits showing file name)
    echo $(wc -l < ${LOG_DIR}/unrecognized_hashes.txt) "Unrecognized"
    echo -e "-------------------------------------------\n" 
}

display_malware () {
        #reset colour
        echo "$(tput sgr0)"
        #set colour to red,bold
        echo "$(tput setaf 1)"
        echo "$(tput bold)"
        echo -e "\n-------------------------------------------"   
        cat ${LOG_DIR}/found_malware.txt
        echo -e "-------------------------------------------"   
        #reset colour
        echo "$(tput sgr0)"
        echo -e "\nPress ENTER to continue";read a
}
        
display_benign () {      
        #set colour to green,bold
        echo "$(tput setaf 2)"
        echo "$(tput bold)"
        echo -e "\n-------------------------------------------"           
        cat ${LOG_DIR}/benign.txt
        echo -e "-------------------------------------------"   
        #reset colour
        echo "$(tput sgr0)"
        echo -e "\nPress ENTER to continue";read a
}
 
find_unrecognized () { 
        #find hashes from hash log not in found found_malware_hahses.txt and output to unrecognized_hahses.txt
        grep -v -f ${LOG_DIR}/found_malware_hashes.txt ${LOG_DIR}/hash.log > ${LOG_DIR}/temp_unrecognized_hashes.txt
        #find hashes from unrecognized_hashes.txt not in found fbenign.txt_hahses.txt and output to unrecognized_hahses.txt
        grep -v -f ${LOG_DIR}/benign.txt_hashes.txt ${LOG_DIR}/temp_unrecognized_hashes.txt > ${LOG_DIR}/unrecognized_hashes.txt
        #
}
        
display_unrecognized () {        
        echo -e "\n-------------------------------------------"   
        echo -e "Unrecognized hashes"
        cat ${LOG_DIR}/unrecognized_hashes.txt
        echo -e "\n-------------------------------------------"   
        echo -e "\nPress ENTER to continue";read a
}

clear_logs () {
rm ${LOG_DIR}/*
}

menu     
